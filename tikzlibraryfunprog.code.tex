\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Defining [funprog] family
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pgfkeys{
  /tikz/.cd,
  funprog/.is family,
  funprog/.search also={/tikz},
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% [use funprog] 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pgfkeys{
  /tikz/use funprog/.append code={
    \pgfkeys{
      /tikz/.cd,
      list/.style={funprog, list=##1},
      base element/.store in=\funprog@baseelement,
      raw element/.style={funprog, \funprog@datastructure/raw element=##1},
      element/.style={funprog, \funprog@datastructure/element=##1},
      index/.style={funprog, \funprog@datastructure/index=##1},
    }
  },
  /tikz/funprog/data structure/.store in=\funprog@datastructure,
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% [list] 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pgfkeys{
  /tikz/funprog/.cd,
  list/.style={
    column sep=-\pgflinewidth,
    data structure=list,
    base element=#1,
    inner sep=0pt,
    name=list #1,
    nodes={
      draw,
      inner sep=0pt,
      minimum size=1cm,
      outer sep=.5\pgflinewidth,
    },
    outer sep=-.5\pgflinewidth,
    row sep=-\pgflinewidth,
  },
  list/.default=a,
  list/element/.style={
    name=#1,
    node contents=$#1$,
  },
  list/raw element/.style={
    node contents=#1,
  },
  list/index/.style={
    name=\funprog@baseelement#1,
    node contents=$\funprog@baseelement_{#1}$,
  },
}

\makeatother
